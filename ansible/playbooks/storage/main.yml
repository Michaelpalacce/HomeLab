- hosts: all
  name: Setup OpenEBS dependencies
  become: yes
  tags:
      - storage
      - storage-setup-openebs-dependencies
  vars_files:
      - "./vars/main.yml"
  tasks:
      - name: Ensure dependencies are installed
        apt:
            name: "{{ packages }}"
            state: present
        vars:
            packages:
                - open-iscsi
                - nfs-common

- hosts: init_master
  name: Setup OpenEBS
  become: yes
  tags:
      - storage
      - storage-setup-openebs
  vars_files:
      - "./vars/main.yml"
  tasks:
      - name: Add a basic-auth secret to use for the ingress
        command: kubectl apply -f https://openebs.github.io/charts/openebs-operator.yaml