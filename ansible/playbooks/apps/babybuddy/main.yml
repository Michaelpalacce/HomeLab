- hosts: init_master
  name: Setup babybuddy
  become: yes
  tags:
      - babybuddy
      - babybuddy-setup
  tasks:
      - name: Cleanup old potential chart
        file:
            path: babybuddy
            state: absent

      - name: Ensure new Chart is present
        copy:
            src: ../../../../Helm/apps/babybuddy
            dest: .

      - name: Install babybuddy namespace
        kubernetes.core.helm:
            name: babybuddy
            create_namespace: true
            release_namespace: babybuddy
            chart_ref: babybuddy/
            values_files: babybuddy/values.yaml

      - name: Cleanup chart, we no longer need this
        file:
            path: babybuddy
            state: absent
