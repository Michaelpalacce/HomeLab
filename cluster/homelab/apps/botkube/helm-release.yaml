---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: botkube
    namespace: botkube
spec:
    interval: 5m
    install:
        createNamespace: true
        crds: CreateReplace
        remediation:
            retries: 3
    upgrade:
        crds: CreateReplace
        remediation:
            retries: 3
    chart:
        spec:
            chart: botkube
            version: v0.15.0
            interval: 5m
            sourceRef:
                kind: HelmRepository
                name: botkube
                namespace: flux-system
    values:
        image:
          tag: v0.12.4
        communications:
          existingSecret: true
          existingSecretName: "configuration"
        config:
          resources:
          - events:
            - error
            name: v1/services
            namespaces:
              ignore:
              - null
              include:
              - all
          - events:
            - error
            name: apps/v1/deployments
            namespaces:
              ignore:
              - null
              include:
              - all
            updateSetting:
              fields:
              - spec.template.spec.containers[*].image
              - status.availableReplicas
              includeDiff: true
          - events:
            - error
            name: apps/v1/statefulsets
            namespaces:
              ignore:
              - null
              include:
              - all
            updateSetting:
              fields:
              - spec.template.spec.containers[*].image
              - status.readyReplicas
              includeDiff: true
          - events:
            - error
            name: networking.k8s.io/v1beta1/ingresses
            namespaces:
              ignore:
              - null
              include:
              - all
          - events:
            - error
            name: v1/nodes
            namespaces:
              ignore:
              - null
              include:
              - all
          - events:
            - error
            name: v1/namespaces
            namespaces:
              ignore:
              - null
              include:
              - all
          - events:
            - create
            - delete
            - error
            name: v1/persistentvolumes
            namespaces:
              ignore:
              - null
              include:
              - all
          - events:
            - create
            - delete
            - error
            name: v1/persistentvolumeclaims
            namespaces:
              ignore:
              - null
              include:
              - all
          - events:
            - error
            name: v1/configmaps
            namespaces:
              ignore:
              - null
              include:
              - all
          - events:
            - error
            name: apps/v1/daemonsets
            namespaces:
              ignore:
              - null
              include:
              - all
            updateSetting:
              fields:
              - spec.template.spec.containers[*].image
              - status.numberReady
              includeDiff: true
          - events:
            - error
            name: batch/v1/jobs
            namespaces:
              ignore:
              - null
              include:
              - all
            updateSetting:
              fields:
              - spec.template.spec.containers[*].image
              - status.conditions[*].type
              includeDiff: true
          - events:
            - all
            name: batch/v1/jobs
            namespaces:
              include:
              - system-upgrade
            updateSetting:
              fields:
              - spec.template.spec.containers[*].image
              - status.conditions[*].type
              includeDiff: true
          - events:
            - error
            name: rbac.authorization.k8s.io/v1/roles
            namespaces:
              ignore:
              - null
              include:
              - all
          - events:
            - error
            name: rbac.authorization.k8s.io/v1/rolebindings
            namespaces:
              ignore:
              - null
              include:
              - all
          - events:
            - error
            name: rbac.authorization.k8s.io/v1/clusterrolebindings
            namespaces:
              ignore:
              - null
              include:
              - all
          - events:
            - error
            name: rbac.authorization.k8s.io/v1/clusterroles
            namespaces:
              ignore:
              - null
              include:
              - all

           ## Custom resource example
          - name: velero.io/v1/backups
            namespaces:
              include:
                - all
            events:
              - all
            updateSetting:
              includeDiff: true
              fields:
                - status.phase
          - name: velero.io/v1/restores
            namespaces:
              include:
                - all
            events:
              - error
              - create
            updateSetting:
              includeDiff: true
              fields:
                - status.phase
          - name: upgrade.cattle.io/v1/plans
            namespaces:
              include:
                - all
            events:
              - all
            updateSetting:
              includeDiff: true
              fields:
                - status.latestVersiom
          settings:
            # -- Cluster name to differentiate incoming messages.
            clustername: HomeLab
            kubectl:
                enabled: true
            ## BotKube logging settings.
            log:
              # -- Sets one of the log levels. Allowed values: `info`, `warn`, `debug`, `error`, `fatal`, `panic`.
              level: info
              # -- If true, disable ANSI colors in logging.
              disableColors: false
