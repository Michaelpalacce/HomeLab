apiVersion: k8s.mariadb.com/v1alpha1
kind: MariaDB
metadata:
  name: mariadb
spec:
  storage:
    size: 15Gi

  replicas: 3

  replication:
    enabled: true
    primary:
      # Whether the operator should automatically perform primary failover.
      autoFailover: true
      # Duration before performing primary failover.
      autoFailoverDelay: 0s
      # Trigger a switchover by declaring the desired primary index.
      # podIndex: 0
  tls:
    enabled: false
---
apiVersion: k8s.mariadb.com/v1alpha1
kind: Database
metadata:
  name: app
spec:
  mariaDbRef:
    name: mariadb
  characterSet: utf8
  collate: utf8_general_ci
  cleanupPolicy: Delete
  requeueInterval: 10h
  retryInterval: 30s
---
apiVersion: k8s.mariadb.com/v1alpha1
kind: PhysicalBackup
metadata:
  name: physicalbackup
spec:
  mariaDbRef:
    name: mariadb
  target: PreferReplica
  compression: bzip2
  storage:
    s3:
      bucket: replacedby
      endpoint: s3.eu-central-2.wasabisys.com
      region: eu-central-2
      accessKeyIdSecretKeyRef:
        name: s3
        key: access-key-id
      secretAccessKeySecretKeyRef:
        name: s3
        key: secret-access-key
  # Define a PVC to use as staging area for keeping the backups while they are being processed.
  stagingStorage:
    persistentVolumeClaim:
      resources:
        requests:
          storage: 1Gi
      accessModes:
        - ReadWriteOnce
  timeout: 1h
  podAffinity: true
  serviceAccountName: backup
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 300m
      memory: 512Mi
