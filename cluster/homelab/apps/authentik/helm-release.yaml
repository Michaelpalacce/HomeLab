---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: authentik
    namespace: authentik
spec:
    interval: 5m
    install:
        createNamespace: true
        crds: CreateReplace
        remediation:
          retries: 3
    upgrade:
        crds: CreateReplace
        remediation:
          retries: 3
    chart:
        spec:
            chart: authentik
            version: 2022.4.1
            interval: 5m
            sourceRef:
                kind: HelmRepository
                name: authentik
                namespace: flux-system
    values:
        env:
            - AUTHENTIK_EMAIL__HOST: ""
            - AUTHENTIK_EMAIL__PORT: ""
            - AUTHENTIK_EMAIL__USERNAME: ""
            - AUTHENTIK_EMAIL__PASSWORD: ""
            - AUTHENTIK_EMAIL__USE_SSL: ""
            - AUTHENTIK_EMAIL__FROM: ""
            - AUTHENTIK_POSTGRESQL__HOST: ""
            - AUTHENTIK_POSTGRESQL__USER: ""
            - AUTHENTIK_POSTGRESQL__PASSWORD: ""
            - AUTHENTIK_POSTGRESQL__NAME: ""
            - AUTHENTIK_REDIS__HOST: ""
            - AUTHENTIK_SECRET_KEY: ""
        envFrom:
            - secretRef:
                  name: db
            - secretRef:
                  name: smtp
            - secretRef:
                  name: authentik
        ingress:
            enabled: true
            tls:
                - hosts:
                      - "*.stefangenov.site"
                  secretName: ingress
            hosts:
                - host: authentik.stefangenov.site
                  paths:
                      - path: "/"
                        pathType: Prefix
