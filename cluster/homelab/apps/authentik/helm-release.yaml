---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: authentik
    namespace: authentik
spec:
    interval: 5m
    install:
        createNamespace: true
        crds: CreateReplace
        remediation:
          retries: 3
    upgrade:
        crds: CreateReplace
        remediation:
          retries: 3
    chart:
        spec:
            chart: ./Helm/apps/authentik
            reconcileStrategy: Revision
            sourceRef:
                kind: GitRepository
                name: flux-system
                namespace: flux-system
    values:
        env: null
        envFrom:
            - secretRef:
                  name: db
            - secretRef:
                  name: smtp
            - secretRef:
                  name: authentik
        ingress:
            enabled: true
            tls:
                - hosts:
                      - "*.stefangenov.site"
                  secretName: ingress
            hosts:
                - host: authentik.stefangenov.site
                  paths:
                      - path: "/"
                        pathType: Prefix
