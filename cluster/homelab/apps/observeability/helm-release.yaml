---
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
    name: observeability
    namespace: observeability
spec:
    interval: 1h
    install:
        createNamespace: true
    chart:
        spec:
            chart: kube-prometheus-stack
            version: 77.10.0
            interval: 1h
            sourceRef:
                kind: HelmRepository
                name: kube-prometheus-stack
                namespace: flux-system
    values:
      grafana:
        ingress:
          ## If true, Grafana Ingress will be created
          ##
          enabled: true
          ingressClassName: nginx

          annotations: {}
            # kubernetes.io/ingress.class: nginx
            # kubernetes.io/tls-acme: "true"

          hosts: 
            - grafana.sgenov.dev

          path: /

          tls:
          - secretName: ingress
            hosts:
              - "*.sgenov.dev"
      crds:
        enabled: true
        ## The CRD upgrade job mitigates the limitation of helm not being able to upgrade CRDs.
        ## The job will apply the CRDs to the cluster before the operator is deployed, using helm hooks.
        ## It deploy a corresponding clusterrole, clusterrolebinding and serviceaccount to apply the CRDs.
        ## This feature is in preview, off by default and may change in the future.
        upgradeJob:
          enabled: true
          forceConflicts: false
